<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>JaxbContextData.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">Common Xml</a> &gt; <a href="index.source.html" class="el_package">org.bremersee.xml</a> &gt; <span class="el_source">JaxbContextData.java</span></div><h1>JaxbContextData.java</h1><pre class="source lang-java linenums">/*
 * Copyright 2020-2022  the original author or authors.
 *
 * Licensed under the Apache License, Version 2.0 (the &quot;License&quot;);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *      http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an &quot;AS IS&quot; BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */

package org.bremersee.xml;

import static java.util.Objects.nonNull;
import static java.util.Objects.requireNonNull;

import java.util.Optional;
import java.util.stream.Stream;
import jakarta.xml.bind.annotation.XmlRootElement;
import jakarta.xml.bind.annotation.XmlType;
import lombok.EqualsAndHashCode;
import lombok.Getter;
import org.springframework.util.Assert;

/**
 * Meta-data to describe a xml model.
 *
 * @author Christian Bremer
 */
@SuppressWarnings(&quot;SameNameButDifferent&quot;)
@EqualsAndHashCode
public final class JaxbContextData implements JaxbContextMember, Comparable&lt;JaxbContextData&gt; {

  @Getter
  private final Class&lt;?&gt; clazz;

  @Getter
  private final String clazzElementSchemaLocation;

  @Getter
  private final String clazzTypeSchemaLocation;

  private final Package pakkage;

  @Getter
  private final String pakkageSchemaLocation;

  /**
   * Instantiates a new jaxb context data.
   *
   * @param clazz the class
   */
  public JaxbContextData(Class&lt;?&gt; clazz) {
<span class="fc" id="L59">    this(clazz, null, null);</span>
<span class="fc" id="L60">  }</span>

  /**
   * Instantiates a new jaxb context data.
   *
   * @param clazz the class
   * @param clazzElementSchemaLocation the class element schema location
   * @param clazzTypeSchemaLocation the class type schema location
   */
  public JaxbContextData(
      Class&lt;?&gt; clazz,
      String clazzElementSchemaLocation,
      String clazzTypeSchemaLocation) {

<span class="fc" id="L74">    this(validate(JaxbContextMember.byClass(clazz)</span>
<span class="fc" id="L75">        .clazzElementSchemaLocation(clazzElementSchemaLocation)</span>
<span class="fc" id="L76">        .clazzTypeSchemaLocation(clazzTypeSchemaLocation)</span>
<span class="fc" id="L77">        .build()));</span>
<span class="fc" id="L78">  }</span>

  /**
   * Instantiates a new jaxb context data.
   *
   * @param pakkage the package
   */
  public JaxbContextData(Package pakkage) {
<span class="fc" id="L86">    this(pakkage, null);</span>
<span class="fc" id="L87">  }</span>

  /**
   * Instantiates a new Jaxb context data.
   *
   * @param clazz the class
   * @param pakkageSchemaLocation the package schema location
   */
  public JaxbContextData(Class&lt;?&gt; clazz, String pakkageSchemaLocation) {
<span class="fc" id="L96">    this(validate(new JaxbContextMemberImpl(</span>
        clazz,
        null,
        null,
        null,
        pakkageSchemaLocation)));
<span class="fc" id="L102">  }</span>

  /**
   * Instantiates a new jaxb context data.
   *
   * @param pakkage the package
   * @param pakkageSchemaLocation the package schema location
   */
  public JaxbContextData(Package pakkage, String pakkageSchemaLocation) {
<span class="fc" id="L111">    this(validate(JaxbContextMember.byPackage(pakkage)</span>
<span class="fc" id="L112">        .schemaLocation(pakkageSchemaLocation)</span>
<span class="fc" id="L113">        .build()));</span>
<span class="fc" id="L114">  }</span>

<span class="fc" id="L116">  JaxbContextData(JaxbContextMember jaxbContextMember) {</span>
<span class="fc" id="L117">    JaxbContextMember validated = validate(jaxbContextMember);</span>
<span class="fc" id="L118">    this.pakkage = validated.getPakkage();</span>
<span class="fc" id="L119">    this.pakkageSchemaLocation = validated.getPakkageSchemaLocation();</span>
<span class="fc" id="L120">    this.clazz = validated.getClazz();</span>
<span class="fc" id="L121">    this.clazzElementSchemaLocation = validated.getClazzElementSchemaLocation();</span>
<span class="fc" id="L122">    this.clazzTypeSchemaLocation = validated.getClazzTypeSchemaLocation();</span>
<span class="fc" id="L123">  }</span>

  private static JaxbContextMember validate(JaxbContextMember source) {
<span class="fc" id="L126">    Assert.notNull(source, &quot;Jaxb context member must be present.&quot;);</span>
<span class="fc bfc" id="L127" title="All 4 branches covered.">    if (nonNull(source.getClazz()) &amp;&amp; nonNull(source.getPakkage())) {</span>
<span class="fc" id="L128">      Assert.isTrue(source.getPakkage().equals(source.getClazz().getPackage()),</span>
          &quot;If package and class are present, class must be a member of the package.&quot;);
<span class="pc bpc" id="L130" title="1 of 2 branches missed.">      if (JaxbUtils.isJaxbModelPackage(source.getPakkage())) {</span>
<span class="nc" id="L131">        return validate(JaxbContextMember.byPackage(source.getPakkage())</span>
<span class="nc" id="L132">            .schemaLocation(source.getPakkageSchemaLocation())</span>
<span class="nc" id="L133">            .build());</span>
      }
<span class="fc" id="L135">      return validate(JaxbContextMember.byClass(source.getClazz())</span>
<span class="fc" id="L136">          .clazzElementSchemaLocation(source.getClazzElementSchemaLocation())</span>
<span class="fc" id="L137">          .clazzTypeSchemaLocation(source.getClazzTypeSchemaLocation())</span>
<span class="fc" id="L138">          .build());</span>
    }
<span class="fc bfc" id="L140" title="All 4 branches covered.">    if (nonNull(source.getClazz()) &amp;&amp; JaxbUtils.isInJaxbModelPackage(source.getClazz())) {</span>
<span class="fc" id="L141">      return validate(JaxbContextMember.byPackage(source.getClazz().getPackage())</span>
<span class="fc" id="L142">          .schemaLocation(source.getPakkageSchemaLocation())</span>
<span class="fc" id="L143">          .build());</span>
    }
<span class="fc bfc" id="L145" title="All 2 branches covered.">    if (nonNull(source.getClazz())</span>
<span class="fc bfc" id="L146" title="All 2 branches covered.">        &amp;&amp; (source.getClazz().isAnnotationPresent(XmlRootElement.class)</span>
<span class="pc bpc" id="L147" title="1 of 2 branches missed.">        || source.getClazz().isAnnotationPresent(XmlType.class))) {</span>
<span class="fc" id="L148">      return source;</span>
<span class="fc bfc" id="L149" title="All 2 branches covered.">    } else if (nonNull(source.getClazz())) {</span>
<span class="fc" id="L150">      throw new IllegalArgumentException(</span>
<span class="fc" id="L151">          String.format(</span>
              &quot;Class '%s' must be annotated with 'XmlRootElement' or 'XmlType'.&quot;,
<span class="fc" id="L153">              source.getClazz().getName()));</span>
    }
<span class="pc bpc" id="L155" title="1 of 4 branches missed.">    if (nonNull(source.getPakkage()) &amp;&amp; JaxbUtils.isJaxbModelPackage(source.getPakkage())) {</span>
<span class="fc" id="L156">      return JaxbContextMember.byPackage(source.getPakkage())</span>
<span class="fc" id="L157">          .schemaLocation(Optional.ofNullable(source.getPakkageSchemaLocation())</span>
<span class="pc bpc" id="L158" title="1 of 2 branches missed.">              .filter(location -&gt; !location.isBlank())</span>
<span class="fc" id="L159">              .or(() -&gt; JaxbUtils.getSchemaLocation(source.getPakkage()))</span>
<span class="fc" id="L160">              .orElse(null))</span>
<span class="fc" id="L161">          .build();</span>
<span class="pc bpc" id="L162" title="1 of 2 branches missed.">    } else if (nonNull(source.getPakkage())) {</span>
<span class="fc" id="L163">      throw new IllegalArgumentException(</span>
<span class="fc" id="L164">          String.format(</span>
              &quot;Package '%s' does not contain 'ObjectFactory.class' or 'jaxb.index'.&quot;,
<span class="fc" id="L166">              source.getPakkage().getName()));</span>
    }
<span class="nc" id="L168">    throw new IllegalArgumentException(&quot;Class or package must be present.&quot;);</span>
  }

  public Package getPakkage() {
<span class="fc bfc" id="L172" title="All 2 branches covered.">    return nonNull(pakkage) ? pakkage : requireNonNull(clazz).getPackage();</span>
  }

  /**
   * Gets key.
   *
   * @return the key
   */
  Object getKey() {
<span class="fc bfc" id="L181" title="All 2 branches covered.">    return nonNull(pakkage) ? pakkage : requireNonNull(clazz);</span>
  }

  /**
   * Gets jaxb classes.
   *
   * @param classLoaders the class loaders
   * @return the jaxb classes
   */
  public Stream&lt;Class&lt;?&gt;&gt; getJaxbClasses(ClassLoader... classLoaders) {
<span class="fc" id="L191">    return JaxbUtils.findJaxbClasses(getPakkage().getName(), classLoaders);</span>
  }

  /**
   * Gets name spaces with schema locations.
   *
   * @return the name spaces with schema locations
   */
  public Stream&lt;SchemaLocation&gt; getNameSpacesWithSchemaLocations() {
<span class="fc" id="L200">    return Stream.of(</span>
<span class="fc" id="L201">            Optional.ofNullable(pakkageSchemaLocation)</span>
<span class="pc bpc" id="L202" title="1 of 2 branches missed.">                .filter(location -&gt; !location.isBlank())</span>
<span class="fc" id="L203">                .flatMap(location -&gt; JaxbUtils.getNameSpace(pakkage)</span>
<span class="fc" id="L204">                    .map(ns -&gt; new SchemaLocation(ns, location))),</span>
<span class="fc" id="L205">            Optional.ofNullable(clazzElementSchemaLocation)</span>
<span class="pc bpc" id="L206" title="1 of 2 branches missed.">                .filter(location -&gt; !location.isBlank())</span>
<span class="fc" id="L207">                .flatMap(location -&gt; JaxbUtils.getNameSpaceOfElement(clazz)</span>
<span class="fc" id="L208">                    .map(ns -&gt; new SchemaLocation(ns, location))),</span>
<span class="fc" id="L209">            Optional.ofNullable(clazzTypeSchemaLocation)</span>
<span class="pc bpc" id="L210" title="1 of 2 branches missed.">                .filter(location -&gt; !location.isBlank())</span>
<span class="fc" id="L211">                .flatMap(location -&gt; JaxbUtils.getNameSpaceOfType(clazz)</span>
<span class="fc" id="L212">                    .map(ns -&gt; new SchemaLocation(ns, location))))</span>
<span class="fc" id="L213">        .flatMap(Optional::stream)</span>
<span class="fc" id="L214">        .distinct();</span>
  }

  @Override
  public String toString() {
<span class="fc" id="L219">    return &quot;JaxbContextData{&quot;</span>
<span class="pc bpc" id="L220" title="1 of 2 branches missed.">        + &quot;clazz=&quot; + (nonNull(clazz) ? clazz.getName() : &quot;null&quot;)</span>
        + &quot;, clazzElementSchemaLocation='&quot; + clazzElementSchemaLocation + '\''
        + &quot;, clazzTypeSchemaLocation='&quot; + clazzTypeSchemaLocation + '\''
<span class="pc bpc" id="L223" title="1 of 2 branches missed.">        + &quot;, pakkage=&quot; + (nonNull(pakkage) ? pakkage.getName() : &quot;null&quot;)</span>
        + &quot;, pakkageSchemaLocation='&quot; + pakkageSchemaLocation + '\''
        + '}';
  }

  @Override
  public int compareTo(JaxbContextData o) {
<span class="pc bpc" id="L230" title="1 of 2 branches missed.">    String a = nonNull(pakkage) ? pakkage.getName() : requireNonNull(clazz).getName();</span>
<span class="pc bpc" id="L231" title="1 of 2 branches missed.">    String b = nonNull(o.pakkage) ? o.pakkage.getName() : requireNonNull(o.clazz).getName();</span>
<span class="fc" id="L232">    return a.compareToIgnoreCase(b);</span>
  }

}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.12.202403310830</span></div></body></html>