<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>JaxbContextData.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">common-xml</a> &gt; <a href="index.source.html" class="el_package">org.bremersee.xml</a> &gt; <span class="el_source">JaxbContextData.java</span></div><h1>JaxbContextData.java</h1><pre class="source lang-java linenums">/*
 * Copyright 2020-2022  the original author or authors.
 *
 * Licensed under the Apache License, Version 2.0 (the &quot;License&quot;);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *      http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an &quot;AS IS&quot; BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */

package org.bremersee.xml;

import static java.util.Objects.nonNull;
import static java.util.Objects.requireNonNull;

import java.util.Optional;
import java.util.stream.Stream;
import javax.xml.bind.annotation.XmlRootElement;
import javax.xml.bind.annotation.XmlType;
import lombok.EqualsAndHashCode;
import org.springframework.util.Assert;

/**
 * Meta-data to describe a xml model.
 *
 * @author Christian Bremer
 */
@SuppressWarnings(&quot;SameNameButDifferent&quot;)
@EqualsAndHashCode
public final class JaxbContextData implements Comparable&lt;JaxbContextData&gt; {

  private final Class&lt;?&gt; clazz;

  private final String clazzElementSchemaLocation;

  private final String clazzTypeSchemaLocation;

  private final Package pakkage;

  private final String pakkageSchemaLocation;

  /**
   * Instantiates a new jaxb context data.
   *
   * @param clazz the class
   */
  public JaxbContextData(Class&lt;?&gt; clazz) {
<span class="fc" id="L54">    this(clazz, null, null);</span>
<span class="fc" id="L55">  }</span>

  /**
   * Instantiates a new jaxb context data.
   *
   * @param clazz the class
   * @param clazzElementSchemaLocation the class element schema location
   * @param clazzTypeSchemaLocation the class type schema location
   */
  public JaxbContextData(
      Class&lt;?&gt; clazz,
      String clazzElementSchemaLocation,
<span class="fc" id="L67">      String clazzTypeSchemaLocation) {</span>

<span class="fc" id="L69">    Assert.notNull(clazz, &quot;Class must be present.&quot;);</span>
<span class="fc bfc" id="L70" title="All 2 branches covered.">    if (JaxbUtils.isInJaxbModelPackage(clazz)) {</span>
<span class="fc" id="L71">      this.pakkage = clazz.getPackage();</span>
<span class="fc" id="L72">      this.pakkageSchemaLocation = JaxbUtils</span>
<span class="fc" id="L73">          .getSchemaLocation(this.pakkage)</span>
<span class="fc" id="L74">          .orElse(null);</span>
<span class="fc" id="L75">      this.clazz = null;</span>
<span class="fc" id="L76">      this.clazzElementSchemaLocation = null;</span>
<span class="fc" id="L77">      this.clazzTypeSchemaLocation = null;</span>
<span class="fc bfc" id="L78" title="All 2 branches covered.">    } else if (clazz.isAnnotationPresent(XmlRootElement.class)</span>
<span class="pc bpc" id="L79" title="1 of 2 branches missed.">        || clazz.isAnnotationPresent(XmlType.class)) {</span>
<span class="fc" id="L80">      this.clazz = clazz;</span>
<span class="fc" id="L81">      this.clazzElementSchemaLocation = Optional.ofNullable(clazzElementSchemaLocation)</span>
<span class="pc bpc" id="L82" title="1 of 2 branches missed.">          .filter(location -&gt; !location.isBlank())</span>
<span class="fc" id="L83">          .orElse(null);</span>
<span class="fc" id="L84">      this.clazzTypeSchemaLocation = Optional.ofNullable(clazzTypeSchemaLocation)</span>
<span class="pc bpc" id="L85" title="1 of 2 branches missed.">          .filter(location -&gt; !location.isBlank())</span>
<span class="fc" id="L86">          .orElse(null);</span>
<span class="fc" id="L87">      this.pakkage = null;</span>
<span class="fc" id="L88">      this.pakkageSchemaLocation = null;</span>
    } else {
<span class="fc" id="L90">      throw new IllegalArgumentException(String.format(</span>
          &quot;Class '%s' is not annotated with XmlRootElement or XmlType nor it is a member a jaxb &quot;
<span class="fc" id="L92">              + &quot;context package.&quot;, clazz.getName()));</span>
    }
<span class="fc" id="L94">  }</span>

  /**
   * Instantiates a new jaxb context data.
   *
   * @param pakkage the package
   */
  public JaxbContextData(Package pakkage) {
<span class="fc" id="L102">    this(pakkage, null);</span>
<span class="fc" id="L103">  }</span>

  /**
   * Instantiates a new Jaxb context data.
   *
   * @param clazz the class
   * @param pakkageSchemaLocation the package schema location
   */
<span class="fc" id="L111">  public JaxbContextData(Class&lt;?&gt; clazz, String pakkageSchemaLocation) {</span>
<span class="fc" id="L112">    Assert.notNull(clazz, &quot;Class must be present.&quot;);</span>
<span class="fc bfc" id="L113" title="All 2 branches covered.">    if (JaxbUtils.isInJaxbModelPackage(clazz)) {</span>
<span class="fc" id="L114">      this.pakkage = clazz.getPackage();</span>
<span class="fc" id="L115">      this.pakkageSchemaLocation = Optional.ofNullable(pakkageSchemaLocation)</span>
<span class="pc bpc" id="L116" title="1 of 2 branches missed.">          .filter(location -&gt; !location.isBlank())</span>
<span class="pc" id="L117">          .or(() -&gt; JaxbUtils.getSchemaLocation(this.pakkage))</span>
<span class="fc" id="L118">          .orElse(null);</span>
<span class="fc" id="L119">      this.clazz = null;</span>
<span class="fc" id="L120">      this.clazzElementSchemaLocation = null;</span>
<span class="fc" id="L121">      this.clazzTypeSchemaLocation = null;</span>
<span class="fc bfc" id="L122" title="All 2 branches covered.">    } else if (clazz.isAnnotationPresent(XmlRootElement.class)</span>
<span class="pc bpc" id="L123" title="1 of 2 branches missed.">        || clazz.isAnnotationPresent(XmlType.class)) {</span>
<span class="fc" id="L124">      this.clazz = clazz;</span>
<span class="fc" id="L125">      this.clazzElementSchemaLocation = null;</span>
<span class="fc" id="L126">      this.clazzTypeSchemaLocation = null;</span>
<span class="fc" id="L127">      this.pakkage = null;</span>
<span class="fc" id="L128">      this.pakkageSchemaLocation = null;</span>
    } else {
<span class="fc" id="L130">      throw new IllegalArgumentException(String.format(</span>
          &quot;Class '%s' is not annotated with XmlRootElement or XmlType nor it is a member a jaxb &quot;
<span class="fc" id="L132">              + &quot;context package.&quot;, clazz.getName()));</span>
    }
<span class="fc" id="L134">  }</span>

  /**
   * Instantiates a new jaxb context data.
   *
   * @param pakkage the package
   * @param pakkageSchemaLocation the package schema location
   */
<span class="fc" id="L142">  public JaxbContextData(Package pakkage, String pakkageSchemaLocation) {</span>
<span class="fc" id="L143">    Assert.notNull(pakkage, &quot;Package must be present.&quot;);</span>
<span class="fc" id="L144">    Assert.isTrue(JaxbUtils.isJaxbModelPackage(pakkage), String.format(</span>
        &quot;Package '%s' does not contain 'ObjectFactory.class' or 'jaxb.index'.&quot;,
<span class="fc" id="L146">        pakkage.getName()));</span>
<span class="fc" id="L147">    this.pakkage = pakkage;</span>
<span class="fc" id="L148">    this.pakkageSchemaLocation = Optional.ofNullable(pakkageSchemaLocation)</span>
<span class="pc bpc" id="L149" title="1 of 2 branches missed.">        .filter(location -&gt; !location.isBlank())</span>
<span class="fc" id="L150">        .or(() -&gt; JaxbUtils.getSchemaLocation(this.pakkage))</span>
<span class="fc" id="L151">        .orElse(null);</span>
<span class="fc" id="L152">    this.clazz = null;</span>
<span class="fc" id="L153">    this.clazzElementSchemaLocation = null;</span>
<span class="fc" id="L154">    this.clazzTypeSchemaLocation = null;</span>
<span class="fc" id="L155">  }</span>

  private Package getPackage() {
<span class="fc bfc" id="L158" title="All 2 branches covered.">    return nonNull(pakkage) ? pakkage : requireNonNull(clazz).getPackage();</span>
  }

  /**
   * Gets key.
   *
   * @return the key
   */
  Object getKey() {
<span class="fc bfc" id="L167" title="All 2 branches covered.">    return nonNull(pakkage) ? pakkage : requireNonNull(clazz);</span>
  }

  /**
   * Gets jaxb classes.
   *
   * @param classLoaders the class loaders
   * @return the jaxb classes
   */
  public Stream&lt;Class&lt;?&gt;&gt; getJaxbClasses(ClassLoader... classLoaders) {
<span class="fc" id="L177">    return JaxbUtils.findJaxbClasses(getPackage().getName(), classLoaders);</span>
  }

  /**
   * Gets name spaces with schema locations.
   *
   * @return the name spaces with schema locations
   */
  public Stream&lt;SchemaLocation&gt; getNameSpacesWithSchemaLocations() {
<span class="fc" id="L186">    return Stream.of(</span>
<span class="fc" id="L187">            Optional.ofNullable(pakkageSchemaLocation)</span>
<span class="pc bpc" id="L188" title="1 of 2 branches missed.">                .filter(location -&gt; !location.isBlank())</span>
<span class="fc" id="L189">                .flatMap(location -&gt; JaxbUtils.getNameSpace(pakkage)</span>
<span class="fc" id="L190">                    .map(ns -&gt; new SchemaLocation(ns, location))),</span>
<span class="fc" id="L191">            Optional.ofNullable(clazzElementSchemaLocation)</span>
<span class="pc bpc" id="L192" title="1 of 2 branches missed.">                .filter(location -&gt; !location.isBlank())</span>
<span class="fc" id="L193">                .flatMap(location -&gt; JaxbUtils.getNameSpaceOfElement(clazz)</span>
<span class="fc" id="L194">                    .map(ns -&gt; new SchemaLocation(ns, location))),</span>
<span class="fc" id="L195">            Optional.ofNullable(clazzTypeSchemaLocation)</span>
<span class="pc bpc" id="L196" title="1 of 2 branches missed.">                .filter(location -&gt; !location.isBlank())</span>
<span class="fc" id="L197">                .flatMap(location -&gt; JaxbUtils.getNameSpaceOfType(clazz)</span>
<span class="fc" id="L198">                    .map(ns -&gt; new SchemaLocation(ns, location))))</span>
<span class="fc" id="L199">        .flatMap(Optional::stream)</span>
<span class="fc" id="L200">        .distinct();</span>
  }

  @Override
  public String toString() {
<span class="fc" id="L205">    return &quot;JaxbContextData{&quot;</span>
<span class="pc bpc" id="L206" title="1 of 2 branches missed.">        + &quot;clazz=&quot; + (nonNull(clazz) ? clazz.getName() : &quot;null&quot;)</span>
        + &quot;, clazzElementSchemaLocation='&quot; + clazzElementSchemaLocation + '\''
        + &quot;, clazzTypeSchemaLocation='&quot; + clazzTypeSchemaLocation + '\''
<span class="pc bpc" id="L209" title="1 of 2 branches missed.">        + &quot;, pakkage=&quot; + (nonNull(pakkage) ? pakkage.getName() : &quot;null&quot;)</span>
        + &quot;, pakkageSchemaLocation='&quot; + pakkageSchemaLocation + '\''
        + '}';
  }

  @Override
  public int compareTo(JaxbContextData o) {
<span class="pc bpc" id="L216" title="1 of 2 branches missed.">    String a = nonNull(pakkage) ? pakkage.getName() : requireNonNull(clazz).getName();</span>
<span class="pc bpc" id="L217" title="1 of 2 branches missed.">    String b = nonNull(o.pakkage) ? o.pakkage.getName() : requireNonNull(o.clazz).getName();</span>
<span class="fc" id="L218">    return a.compareToIgnoreCase(b);</span>
  }

}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.7.202105040129</span></div></body></html>